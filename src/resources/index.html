<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="shortcut icon" href="data:image/x-icon;base64,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"/>
		<title>Salmonberry</title>
	</head>

	<style>
		body {
			font-family: monospace;
		}

		.small {
			font-size: .8em;
		}

		.faded {
			opacity: .3;
		}

		.step-1 {

		}

		/* disabling toggle for step1 */
		.step-1-disabler {
		}

		.step-2-disabler {
		}

		.step-2 {
		}

		#drawspace-environment {
  			position: absolute;
  			top: 0;
  			left: 0;
			margin-bottom: 7px;
		}

		#drawspace-entities {
  			position: absolute;
  			top: 0;
  			left: 0;
		}

		#drawspace {
			position: relative;
			display: inline-block;
			width: 289px;
			height: 304px;
		}

		.controlbutton{
			-webkit-touch-callout: none;
			-webkit-user-select: none; 
			-khtml-user-select: none;
			-moz-user-select: none; 
			-ms-user-select: none; 
			-o-user-select: none;
			user-select: none;

			width: 35px;
			height: 35px;
			border-radius: 5px;
		}

		#logo {
			float: left;
			padding: 5px;
			filter: drop-shadow(3px 3px 3px rgba(0, 0, 0, .2));
			transform: rotate(30deg);
		}

		.orange {
			color: rgb(240, 115, 10);
		}
	</style>


	<body>
		<!-- STEP 1 -->
		<div style="max-width: 600px; margin-left: auto; margin-right: auto;">

			<img id="logo" alt="A small salmonberry logo" src="data:image/png;base64,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"/>

			<h2 style="margin-bottom: 0px;">Salmonberry</h2>
			<p class="small" style="margin-top: 0px;">
				v0.0.4<span class="faded">&emsp;|&emsp;</span>Pre-alpha<span class="faded">&emsp;|&emsp;</span>No saves
				<br/><strong>Ticks (ms):</strong> Env <span class="orange" id="tick-time">????</span>, Entity <span  class="orange"  id="entity-tick-time">????</span>
			</p>
			<div class="slidecontainer">
  				<div><span class="small" style="float: left; padding-top: 5px;">ASCII Contrast: </span></div><div><input type="range" min="0" max="255" value="40" class="slider" id="myRange" onchange="drawEnvironment(lastDrawnEnvironment);"></div>
			</div>
			<hr class="faded"/>
			<p>
				<input autocomplete="false" hidden></input>
				<strong>Username:</strong> <input class="step-1 step-1-disabler" id="username" autocomplete="off" style="width: 100px" type="input" name="id"></input>
				<button id="username-confirm" class="step-1 step-1-disabler" value="Join" onClick="resolveID();">Join</button>
				<button class="step-2 step-2-disabler" onClick="reset();">Exit</button>
				<br/><span class="small">Once created, your icon will be the first letter of your Username</span>
			</p>

			<!-- STEP 2 -->
			<hr class="faded"/>
			<div class="step-2" style="width: 100%; text-align: center;">
				<div id="drawspace">
					<canvas id="drawspace-environment" width="289" height="304"></canvas>
					<canvas id="drawspace-entities" width="289" height="304"></canvas>
				</div>
				<form style="margin-top: 0px;">
					<input class="controlbutton step-2-disabler" type="button" name="input" value="&#9664;" onClick="sendInput('L');">
					<input class="controlbutton step-2-disabler" type="button" name="input" value="&#9654;" onClick="sendInput('R');">
					&nbsp;
					<input class="controlbutton step-2-disabler" type="button" name="input" value="&#9650;" onClick="sendInput('U');">
					<input class="controlbutton step-2-disabler" type="button" name="input" value="&#9660;" onClick="sendInput('D');">
					<p class="small" style="margin-bottom: 0px; margin-top: 0px;">WASD and arrow keys are also valid inputs</p>
				</form>
			</div>

		</div>
		<!-- Page interactions -->
		<script type="text/javascript">

			// Colors
			let colorLookup = {};
			let lastDrawnEnvironment = null;
			let lastDrawnEntities = null;

			// 40 different for now
			colorLookup[","] = { r:90, g:190, b:80, a:1 };
			colorLookup["."] = { r:120, g:210, b:70, a:1 };
			colorLookup["~"] = { r:110, g:150, b:200, a:1 };
			colorLookup["="] = { r:170, g:160, b:150, a:1 };
			colorLookup["&"] = { r:120, g:100, b:80, a:1 };
			colorLookup["%"] = { r:30, g:40, b:50, a:1 };

			// Variables: General
			let id = null;
			let step = 1;
			const activeTickTime = 300;
			const idleTickTime = 2000;

			// Variables: Drawing related
			const offset_vertical = 12;  // line height
			const offset_horizontal = 7.2; // char width
			const offset_color_offset = 2;
			const draw_font = "12px Courier";

			// Groups
			let bundle1 = document.getElementsByClassName("step-1"); // Section/Step 1
			let bundle2 = document.getElementsByClassName("step-2"); // Section/Step 2
			let bundle1Disabler = document.getElementsByClassName("step-1-disabler"); // Form elements with disabling for Section/Step 1
			let bundle2Disabler = document.getElementsByClassName("step-2-disabler"); // Form elements with disabling for Section/Step 2

			// Listeners
			window.addEventListener('keydown', (e) => {
				if(step == 2) {
					switch(e.key) {
						case "w":
						case "ArrowUp": sendInput("U"); break;
						
						case "a":
						case "ArrowLeft": sendInput("L"); break;

						case "s":
						case "ArrowDown": sendInput("D"); break;

						case "d":
						case "ArrowRight": sendInput("R"); break;
					}
				}
			});

			function getColor(color) {
				if(colorLookup.hasOwnProperty(color)) {
					return colorLookup[color];
				} else {
					return null;
				}
			}

			function setEnabled(target, isEnabled) {
				for (i = 0; i < target.length; i++) {
					if(isEnabled) {
						target[i].disabled = false;
					} else {
						target[i].disabled = true;
					}
				}
			}

			function setVisibility(bundle, isVisible) {
				for (i = 0; i < bundle.length; i++) {
					if(isVisible) {
						bundle[i].style.display = "inline-block";
					} else {
						bundle[i].style.display = "none";
					}
				}
			}

			function resolveID() {
				let username = document.getElementById("username").value;

				if(username.length >= 1)
				{
					sendEventCreate(username, ()=>{
						id = username;
						step++;
						setVisibility(bundle2, true);
						setEnabled(bundle1Disabler, false);
						setEnabled(bundle2Disabler, true);

						sendEventState("environment",()=>{});
						sendEventState("entities");
					});
				}
			}

			function reset() {
				window.location.href = window.location.href.split('?')[0];
			}


			  //////////////////////////////////
			 // Requests to send and whatnot //
			//////////////////////////////////

			function func() {
				console.log(this.responseText)
			}

			function sendEventState(layer) {
				sendRequest("state?id=" + id + "&layer=" + layer,
					function() {
						if(layer == "environment") {
							lastDrawnEnvironment = this.responseText;
							drawEnvironment(this.responseText);
						} else if (layer == "entities") {
							lastDrawnEntities = this.responseText;
							drawEntities(this.responseText);
						} else {
							drawEnvironment(this.responseText);
						}
					}),
					(err) => {
						console.log("Error retrieving state for layer '" + layer + "'!"); 
					};
			}

			function sendEventCreate(targetID, onSuccess) {
				sendRequest("create?id=" + targetID,
					() => { 
						onSuccess();
						console.log("Successfully created ID: " + targetID);
					},
					(err) => {
						console.log("Error sending create request!"); 
					});
			}

			function sendInput(input) {
				sendRequest("input?id=" + id + "&input=" + input,
					function() { 
						sendEventState("entities");
				    },
					(err) => {
						console.log("Error sending create request!"); 
					});
			}


			  ////////////////////////////////////////////////
			 // Helper functions, some from around the web //
			////////////////////////////////////////////////

			// takes the JSON state response and draws it out
			function drawEnvironment(rawResponse) {
				if(rawResponse == null) {
					return;
				}

				let c = document.getElementById("drawspace-environment");
				let ctx = c.getContext("2d");
				let state = JSON.parse(rawResponse);


				// Split manually because fillText doesn't handle multiple lines.
				let toDraw = state.data.split('\n');
				
				// Clear the canvas before drawing, and set info			
				const shade = -1 * document.getElementById("myRange").value; //-40;
				ctx.clearRect(0, 0, c.width, c.height);
				ctx.font = draw_font;
				
				// Draw it all!
				for(let y = 0; y < toDraw.length; ++y) {
					for(let x = 0; x < toDraw[y].length; ++x) {
						let char = toDraw[y][x];

						let c = getColor(char);

						//ctx.fillRect(x, y, 1, 1 ); // < Accidentally created a minimap
						ctx.fillStyle = c ? `rgba(${c.r+shade},${c.g+shade},${c.b+shade},${c.a})` : "rgba(20, 30, 40, 1)";
						ctx.fillRect(x * offset_horizontal, y * offset_vertical + offset_color_offset,  Math.ceil(offset_horizontal),  Math.ceil(offset_vertical));
						ctx.fillStyle = c ? `rgba(${c.r},${c.g},${c.b},${c.a})`: "white";
						ctx.fillText(char, offset_horizontal * x, offset_vertical * (y + 1));
					}
				}
			}

			// takes the JSON state response and draws it out
			function drawEntities(rawResponse) {
				if(rawResponse == null) {
					return;
				}

				let c = document.getElementById("drawspace-entities");
				let ctx = c.getContext("2d");
				let state = JSON.parse(rawResponse);


				// Split manually because fillText doesn't handle multiple lines.
				let toDraw = state.data.split('\n');

				// Clear canvas before drawign
				ctx.clearRect(0, 0, c.width, c.height);
				ctx.font = draw_font;

				for(let y = 0; y < toDraw.length; ++y) {
					for(let x = 0; x < toDraw[y].length; ++x) {
						let char = toDraw[y][x];


						if(char == ' ')
							continue;

						let c = getColor(char);

						ctx.fillStyle = c ? `rgba(${c.r},${c.g},${c.b},${c.a})`: "white";
						ctx.fillText(char, offset_horizontal * x, offset_vertical * (y + 1));
					}
				}

				if(step == 1)
				{
					const height = 24;
					ctx.fillStyle = "white";
					ctx.font = "" + height + "px courier";
					ctx.fillText("Choose a username", 24, height);
					ctx.fillText("to join the world", 24, height * 2)
				}
			}

			// endpoint is the location on the server to hit:
			function sendRequest(endpoint, onLoad, onError)
			{
				let url = "http://{{TARGET_ADDR}}/" + endpoint;
				//console.log("Sending to " + url);
				let httpReq = new XMLHttpRequest();

				httpReq.onload = onLoad;
				httpReq.onerror = onError;
				httpReq.open('POST', url, true);
				httpReq.setRequestHeader('Content-type', 'application/json');
				httpReq.send();
			}

			// From https://davidwalsh.name/query-string-javascript
			function getUrlParameter(name) {
				name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
				var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
				var results = regex.exec(location.search);
				return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
			};

			// From https://stackoverflow.com/a/26257722/5383198
			function removeURLParameter(url, parameter) {
				let urlparts= url.split('?');   

				if (urlparts.length >= 2) {
					let prefix = encodeURIComponent(parameter)+'=';
					let pars = urlparts[1].split(/[&;]/g);

					for (let i = pars.length; i-- > 0;) {
						if (pars[i].lastIndexOf(prefix, 0) !== -1) {  
							pars.splice(i, 1);
						}
					}

					url = urlparts[0] + '?' + pars.join('&');
				}

				return url;
			}


			  ///////////////////////////////////
			 // Any recurring / initial setup //
			///////////////////////////////////
			
			// Disable step 2 by default
			setEnabled(bundle2Disabler, false);

			// Get the input field
			let input = document.getElementById("username");

			// Execute a function when the user releases a key on the keyboard
			input.addEventListener("keyup", function(event) {
			  if (event.keyCode === 13) { // That's enter
			    event.preventDefault();
			    document.getElementById("username-confirm").click();
			  }
			});

			// Start up at idle tick rate
			sendEventState("environment");
			sendEventState("entities");

			document.getElementById('tick-time').innerHTML = idleTickTime;
			document.getElementById('entity-tick-time').innerHTML = idleTickTime;

			setInterval(function() { 
					sendEventState("environment");
					document.getElementById('tick-time').innerHTML = idleTickTime;
					if(step == 1) {
						document.getElementById('entity-tick-time').innerHTML = idleTickTime;
						sendEventState("entities");
					}
				}, idleTickTime);

			// Prepare for active tick rate
			setInterval(function() { 
					if(step == 2) {
						document.getElementById('entity-tick-time').innerHTML = activeTickTime;
						sendEventState("entities");
					}
				}, activeTickTime);
		</script>
	</body>
</html>