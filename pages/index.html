<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<title>Salmonberry</title>
	</head>

	<style>
		body {
			font-family: monospace;
		}

		.small {
			font-size: .8em;
		}

		.faded {
			opacity: .3;
			box-shadow: 0px 2px 4px rgba(0, 0, 0, .2);
		}

		.step-1 {

		}

		/* disabling toggle for step1 */
		.step-1-disabler {

		}

		.step-2 {
			display: none;
		}
	</style>


	<body>
		<!-- STEP 1 -->
		<div style="max-width: 600px; margin-left: auto; margin-right: auto;">
		<h2 style="margin-bottom: 0px;">Salmonberry</h2>
		<p class="small" style="margin-top: 0px;">
			v0.0.2
			<br/>This version does not retain any information between runs.
			<br/>Refresh tick rate currently every: <u><code style="color: rgb(250, 125, 10)">1000</code></u> ms
		</p>

		<hr class="faded"/>
		<p>
			<input autocomplete="false" hidden></input>
			Username: <input class="step-1 step-1-disabler" id="username" autocomplete="off" style="width: 150px" type="input" name="id"></input>
			<button class="step-1 step-1-disabler" value="Join" onClick="resolveID();">Join</button> <button class="step-2" onClick="reset();">Exit</button>
			<br/><span class="small">Once created, your icon will be the first letter of your Username</span>
		</p>

		<!-- STEP 2 -->
		<div class="step-2">
			<form action='?' method='get'>
				<hr class="faded"/>
				<br/>
				<br/>
				<input type="button" name="input" value="U" onClick="qs('U');" style="display: none;">
				
				<br/>
				<input type="button" name="input" value="L" onClick="qs('L');" style="display: none;">
				<input class="s-btn" type="button" name="input" value="R" onClick="qs('R');" style="display: none;">
				
				<br/>
				<input class="s-btn" type="button" name="input" value="D" onClick="qs('D');" style="display: none;">
			</form>
		</div>


		<!-- Page interactions -->
		<script type="text/javascript">

			// Variables
			let id = null;
			let step = 1;

			// Groups
			let bundle1 = document.getElementsByClassName("step-1"); // Section/Step 1
			let bundle2 = document.getElementsByClassName("step-2"); // Section/Step 2
			let bundle1Disabler = document.getElementsByClassName("step-1-disabler"); // Form elements with disabling for Section/Step 1

			// Listeners
			window.addEventListener('keydown', (e) => {
				if(step > 1) {
					switch(e.key) {
						case "ArrowLeft": sendInput("L"); break;
						case "ArrowRight": sendInput("R"); break;
						case "ArrowUp": sendInput("U"); break;
						case "ArrowDown": sendInput("D"); break;
					}
				}
			});

			function setEnabled(target, isEnabled) {
				for (i = 0; i < target.length; i++) {
					if(isEnabled) {
						target[i].disabled = false;
					} else {
						target[i].disabled = true;
					}
				}
			}

			function setVisibility(bundle, isVisible) {
				for (i = 0; i < bundle.length; i++) {
					if(isVisible) {
						bundle[i].style.display = "inline";
					} else {
						bundle[i].style.display = "none";
					}
				}
			}

			function resolveID() {
				let username = document.getElementById("username");

				if(username.value.length >= 1)
				{
					id = "jam";
					step++;
					setVisibility(bundle2, true);
					setEnabled(bundle1Disabler, false);
				}
			}

			function reset() {
				window.location.href = window.location.href.split('?')[0];
			}


			  //////////////////////////////////
			 // Requests to send and whatnot //
			//////////////////////////////////

			function sendEventState() {
				// REQUEST
			}

			function sendEventCreate() {
				// REQUEST
			}

			function sendInput() {
				// REQUEST
			}


			  //////////////////////////////////////////
			 // Helper functions from around the web //
			//////////////////////////////////////////

			// From https://davidwalsh.name/query-string-javascript
			function getUrlParameter(name) {
				name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
				var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
				var results = regex.exec(location.search);
				return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
			};

			// From https://stackoverflow.com/a/26257722/5383198
			function removeURLParameter(url, parameter) {
				let urlparts= url.split('?');   

				if (urlparts.length >= 2) {
					let prefix = encodeURIComponent(parameter)+'=';
					let pars = urlparts[1].split(/[&;]/g);

					for (let i = pars.length; i-- > 0;) {
						if (pars[i].lastIndexOf(prefix, 0) !== -1) {  
							pars.splice(i, 1);
						}
					}

					url = urlparts[0] + '?' + pars.join('&');
				}

				return url;
			}
		</script>
	</body>
</html>