<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<title>Salmonberry</title>
	</head>

	<style>
		body {
			font-family: monospace;
		}
		.s-btn {
			width: 30px;
			margin: 1px;
		}
		.s-btn-group {
			text-align: center;
			width: 250px;
			float: left;
		}
	</style>

	<body>
		<div style="max-width: 600px; margin-left: auto; margin-right: auto;">
		<h2>Salmonberry</h2>
		<p>Forced refresh ticks happen once username and symbol are selected.</p>
		<hr/>
		<pre id="s-pre" style="text-align: center; display: none;">{{content}}</pre>
		<br/>
		<hr/>
		<div class="s-btn-group">
			<form action='?' method='get'>
					Username: <input id="s-id" class="s-btn" style="width: 100px" type="input" name="id" required>
					<button id="s-create">Create</button>
					<p id="s-txt">Once created, your icon will be the first letter of your username</p>
					<br/>
					<br/>
					<input id="s-b-u" class="s-btn" type="button" name="input" value="U" onClick="qs('U');" style="display: none;">
					
					<br/>
					<input id="s-b-l" class="s-btn" type="button" name="input" value="L" onClick="qs('L');" style="display: none;">
					<input id="s-b-r" class="s-btn" type="button" name="input" value="R" onClick="qs('R');" style="display: none;">
					
					<br/>
					<input id="s-b-d" class="s-btn" type="button" name="input" value="D" onClick="qs('D');" style="display: none;">
			</form>
		</div>
		<div id="s-r-r" style="float: right; display: none;">
			<button onClick="reload();">Reload</button> - <button onClick="reset();">Reset</button>
		</div>
		</div>


		<!-- Page interactions -->
		<script type="text/javascript">
			let canInput = false;
			window.addEventListener('keydown', (e) => {
				if(canInput) {
					switch(e.key) {
						case "ArrowLeft": qs("L"); break;
						case "ArrowRight": qs("R"); break;
						case "ArrowUp": qs("U"); break;
						case "ArrowDown": qs("D"); break;
					}
				}
			});

			function qs(dir) {
				window.location.href = "?input=" + dir + "&id=" + document.getElementById('s-id').value + "&icon=" + document.getElementById('s-icon').value;
			}

			// From https://davidwalsh.name/query-string-javascript
			function getUrlParameter(name) {
				name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
				var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
				var results = regex.exec(location.search);
				return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
			};

			// From https://stackoverflow.com/a/26257722/5383198
			function removeURLParameter(url, parameter) {
				let urlparts= url.split('?');   

				if (urlparts.length >= 2) {
					let prefix = encodeURIComponent(parameter)+'=';
					let pars = urlparts[1].split(/[&;]/g);

					for (let i = pars.length; i-- > 0;) {
						if (pars[i].lastIndexOf(prefix, 0) !== -1) {  
							pars.splice(i, 1);
						}
					}

					url = urlparts[0] + '?' + pars.join('&');
				}

				return url;
			}

			function reload() {
				window.location.href = removeURLParameter(window.location.href, "input");
			}

			function reset() {
				window.location.href = window.location.href.split('?')[0];
			}

			// Set-up code here
			let id = getUrlParameter('id');
			if(id)
			{
				document.getElementById('s-id').value = id;
				document.getElementById('s-id').disabled = true;

				// Make this an "On Loaded" class and then just tweak the class itself.
				document.getElementById('s-b-u').style.display = "initial";
				document.getElementById('s-b-d').style.display = "initial";
				document.getElementById('s-b-l').style.display = "initial";
				document.getElementById('s-b-r').style.display = "initial";
				document.getElementById('s-pre').style.display = "initial";
				document.getElementById('s-r-r').style.display = "initial";
				canInput = true;

				document.getElementById('s-create').style.display = "none";
				document.getElementById('s-txt').style.display = "none";

				setTimeout(reload, 1000);
			}
		</script>
	</body>
</html>